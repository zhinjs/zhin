# @zhin.js/cli

Zhin æœºå™¨äººæ¡†æ¶çš„å…¨åŠŸèƒ½å‘½ä»¤è¡Œå·¥å…·ï¼Œæä¾›é¡¹ç›®åˆ›å»ºã€å¼€å‘è°ƒè¯•ã€æ’ä»¶æ„å»ºã€è¿›ç¨‹ç®¡ç†ç­‰å®Œæ•´å¼€å‘æµç¨‹æ”¯æŒã€‚

## æ ¸å¿ƒåŠŸèƒ½

- ğŸ§© **æ’ä»¶å¼€å‘**: å¿«é€Ÿåˆ›å»ºæ’ä»¶åŒ…ï¼Œè‡ªåŠ¨é…ç½®ä¾èµ–
- ğŸ”¥ **å¼€å‘æ¨¡å¼**: çƒ­é‡è½½å¼€å‘æœåŠ¡å™¨ï¼Œå®æ—¶ä»£ç æ›´æ–°
- ğŸ“¦ **æ’ä»¶æ„å»º**: æ„å»ºç‹¬ç«‹æ’ä»¶åŒ…ï¼ˆapp + clientï¼‰
- ğŸ› ï¸ **è¿›ç¨‹ç®¡ç†**: ç”Ÿäº§ç¯å¢ƒå¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€åå°è¿è¡Œ
- âš™ï¸ **å¤šè¿è¡Œæ—¶**: æ”¯æŒ Node.js å’Œ Bun è¿è¡Œæ—¶

> **æ³¨æ„**: é¡¹ç›®åˆå§‹åŒ–åŠŸèƒ½å·²ç§»è‡³ `create-zhin-app`ï¼Œè¯·ä½¿ç”¨ `npm create zhin-app` åˆ›å»ºæ–°é¡¹ç›®ã€‚

## å‘½ä»¤è¯¦è§£

### new - åˆ›å»ºæ’ä»¶

åˆ›å»ºæ–°çš„æ’ä»¶åŒ…ï¼Œè‡ªåŠ¨æ·»åŠ åˆ°é¡¹ç›®ä¾èµ–ï¼š

```bash
zhin new [plugin-name] [options]
```

**é€‰é¡¹ï¼š**
- `--skip-install`: è·³è¿‡ä¾èµ–å®‰è£…

**ç”Ÿæˆçš„æ’ä»¶ç»“æ„ï¼š**
```
plugins/my-plugin/
â”œâ”€â”€ app/                    # æ’ä»¶é€»è¾‘ä»£ç 
â”‚   â””â”€â”€ index.ts           # æ’ä»¶å…¥å£
â”œâ”€â”€ client/                 # å®¢æˆ·ç«¯é¡µé¢
â”‚   â”œâ”€â”€ index.tsx          # é¡µé¢å…¥å£
â”‚   â””â”€â”€ pages/             # React ç»„ä»¶
â”‚       â””â”€â”€ index.tsx
â”œâ”€â”€ lib/                    # app æ„å»ºè¾“å‡º
â”œâ”€â”€ dist/                   # client æ„å»ºè¾“å‡º
â”œâ”€â”€ package.json           # æ’ä»¶é…ç½®
â”œâ”€â”€ tsconfig.json          # TypeScript æ ¹é…ç½®
â”œâ”€â”€ tsconfig.app.json      # app æ„å»ºé…ç½®
â”œâ”€â”€ tsconfig.client.json   # client æ„å»ºé…ç½®
â”œâ”€â”€ README.md              # æ’ä»¶æ–‡æ¡£
â””â”€â”€ CHANGELOG.md           # å˜æ›´æ—¥å¿—
```

**è‡ªåŠ¨é…ç½®ï¼š**
- âœ… åˆ›å»ºå®Œæ•´çš„ npm åŒ…ç»“æ„
- âœ… é…ç½® TypeScript ç¼–è¯‘
- âœ… è‡ªåŠ¨æ·»åŠ åˆ°æ ¹ `package.json` ä¾èµ–ï¼ˆ`workspace:*`ï¼‰
- âœ… è‡ªåŠ¨å®‰è£…ä¾èµ–
- âœ… ç”Ÿæˆç¤ºä¾‹ä»£ç ï¼ˆå‘½ä»¤ã€é¡µé¢ï¼‰

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# äº¤äº’å¼åˆ›å»º
zhin new

# ç›´æ¥æŒ‡å®šåç§°
zhin new my-awesome-plugin

# è·³è¿‡ä¾èµ–å®‰è£…
zhin new my-plugin --skip-install
```

### dev - å¼€å‘æ¨¡å¼

å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒçƒ­é‡è½½å’Œå®æ—¶è°ƒè¯•ï¼š

```bash
zhin dev [options]
```

**ç‰¹æ€§ï¼š**
- ğŸ”¥ **çƒ­æ¨¡å—æ›¿æ¢ (HMR)**: ä»£ç ä¿®æ”¹å³æ—¶ç”Ÿæ•ˆ
- ğŸ” **å®æ—¶ç›‘æ§**: è‡ªåŠ¨æ£€æµ‹æ–‡ä»¶å˜åŒ–
- ğŸ› ï¸ **è°ƒè¯•å‹å¥½**: è¯¦ç»†é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
- ğŸ“Š **æ€§èƒ½ç›‘æ§**: å®æ—¶æ€§èƒ½ç»Ÿè®¡

**é€‰é¡¹ï¼š**
- `-p, --port [port]`: HTTP æœåŠ¡ç«¯å£ï¼Œé»˜è®¤ 8086
- `--verbose`: æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—è¾“å‡º
- `--bun`: ä½¿ç”¨ bun è¿è¡Œæ—¶ï¼ˆé»˜è®¤ä½¿ç”¨ tsxï¼‰

**ç¯å¢ƒå˜é‡ï¼š**
```bash
NODE_ENV=development
ZHIN_DEV_MODE=true
HTTP_PORT=8086
ZHIN_VERBOSE=false
```

### start - ç”Ÿäº§å¯åŠ¨

ç”Ÿäº§ç¯å¢ƒå¯åŠ¨æœºå™¨äººï¼Œæ”¯æŒå‰å°å’Œåå°è¿è¡Œï¼š

```bash
zhin start [options]
```

**ç‰¹æ€§ï¼š**
- ğŸš€ **é«˜æ€§èƒ½**: åŸºäºç¼–è¯‘åçš„ JavaScript è¿è¡Œ
- ğŸ”„ **è‡ªåŠ¨é‡å¯**: æ”¯æŒé…ç½®çƒ­æ›´æ–°é‡å¯ (exit code 51)
- ğŸ“ **æ—¥å¿—ç®¡ç†**: æ”¯æŒæ—¥å¿—æ–‡ä»¶è¾“å‡º
- ğŸ›¡ï¸ **è¿›ç¨‹ç®¡ç†**: å®Œå–„çš„è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†

**é€‰é¡¹ï¼š**
- `-d, --daemon`: åå°è¿è¡Œæ¨¡å¼
- `--log-file [file]`: æŒ‡å®šæ—¥å¿—æ–‡ä»¶è·¯å¾„
- `--bun`: ä½¿ç”¨ bun è¿è¡Œæ—¶ï¼ˆé»˜è®¤ä½¿ç”¨ nodeï¼‰

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# å‰å°è¿è¡Œ
zhin start

# åå°è¿è¡Œ
zhin start --daemon

# åå°è¿è¡Œå¹¶è®°å½•æ—¥å¿—
zhin start --daemon --log-file ./logs/bot.log

# ä½¿ç”¨ bun è¿è¡Œæ—¶
zhin start --bun
```

### restart - é‡å¯æœåŠ¡

é‡å¯ç”Ÿäº§æ¨¡å¼ä¸‹è¿è¡Œçš„æœºå™¨äººï¼š

```bash
zhin restart
```

**åŠŸèƒ½ï¼š**
- ğŸ”„ æ£€æµ‹è¿è¡Œä¸­çš„è¿›ç¨‹
- ğŸ“‹ è¯»å– PID æ–‡ä»¶
- âš¡ å‘é€é‡å¯ä¿¡å·
- ğŸ› ï¸ è‡ªåŠ¨æ•…éšœå¤„ç†

### stop - åœæ­¢æœåŠ¡

åœæ­¢è¿è¡Œä¸­çš„æœºå™¨äººè¿›ç¨‹ï¼š

```bash  
zhin stop
```

**åŠŸèƒ½ï¼š**
- ğŸ›‘ ä¼˜é›…åœæ­¢è¿›ç¨‹
- ğŸ” è‡ªåŠ¨æ£€æµ‹è¿è¡ŒçŠ¶æ€
- ğŸ§¹ æ¸…ç† PID æ–‡ä»¶
- ğŸ“ è¯¦ç»†åœæ­¢æ—¥å¿—

### build - æ„å»ºæ’ä»¶

æ„å»º `plugins/` ç›®å½•ä¸‹çš„æ’ä»¶åŒ…ï¼š

```bash
zhin build [plugin] [options]
```

**å‚æ•°ï¼š**
- `[plugin]`: å¯é€‰ï¼ŒæŒ‡å®šè¦æ„å»ºçš„æ’ä»¶åç§°ï¼ˆä¸æŒ‡å®šåˆ™æ„å»ºæ‰€æœ‰æ’ä»¶ï¼‰

**é€‰é¡¹ï¼š**
- `--clean`: æ„å»ºå‰æ¸…ç†è¾“å‡ºç›®å½•ï¼ˆ`lib/` å’Œ `dist/`ï¼‰

**åŠŸèƒ½ï¼š**
- ğŸ“¦ æ„å»ºæ’ä»¶çš„ app ä»£ç ï¼ˆTypeScript â†’ lib/ï¼‰
- ï¿½ æ„å»ºæ’ä»¶çš„ client é¡µé¢ï¼ˆTypeScript â†’ dist/ï¼‰
- ï¿½ğŸ¯ å®Œæ•´çš„ç±»å‹æ£€æŸ¥
- ğŸ—‚ï¸ è‡ªåŠ¨ç»„ç»‡è¾“å‡ºæ–‡ä»¶
- âš¡ å¹¶è¡Œæ„å»ºä¼˜åŒ–

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# æ„å»ºæ‰€æœ‰æ’ä»¶
zhin build

# åªæ„å»ºç‰¹å®šæ’ä»¶
zhin build my-plugin

# æ¸…ç†åæ„å»º
zhin build --clean

# æ¸…ç†åæ„å»ºç‰¹å®šæ’ä»¶
zhin build my-plugin --clean
```

**æ³¨æ„ï¼š**
- âŒ ä¸ç”¨äºæ„å»ºä¸»åº”ç”¨ï¼ˆapp æœ¬èº«ä¸éœ€è¦æ„å»ºï¼‰
- âœ… åªæ„å»º `plugins/` ç›®å½•ä¸‹çš„ç‹¬ç«‹æ’ä»¶åŒ…
- âœ… æ¯ä¸ªæ’ä»¶ä½¿ç”¨è‡ªå·±çš„ `package.json` ä¸­çš„ `build` è„šæœ¬

## å®Œæ•´å·¥ä½œæµç¨‹

### 1. åˆ›å»ºæ–°é¡¹ç›®

```bash
# ä½¿ç”¨ create-zhin-appï¼ˆæ¨èï¼‰
npm create zhin-app my-awesome-bot
# æˆ–
pnpm create zhin-app my-awesome-bot

cd my-awesome-bot
```

### 2. å¼€å‘é˜¶æ®µ

```bash
# å¼€å‘æ¨¡å¼å¯åŠ¨ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
pnpm dev
# æˆ–
zhin dev

# è¯¦ç»†æ—¥å¿—æ¨¡å¼
zhin dev --verbose

# è‡ªå®šä¹‰ç«¯å£
zhin dev --port 8080
```

### 3. åˆ›å»ºæ’ä»¶

```bash
# åˆ›å»ºæ–°æ’ä»¶
zhin new my-awesome-plugin

# æ’ä»¶ä¼šè‡ªåŠ¨æ·»åŠ åˆ° package.json ä¾èµ–
# åœ¨é…ç½®æ–‡ä»¶ä¸­å¯ç”¨æ’ä»¶
# ç¼–è¾‘ zhin.config.tsï¼Œæ·»åŠ åˆ° plugins æ•°ç»„ï¼š
# plugins: ['adapter-process', 'http', 'console', 'my-awesome-plugin']
```

### 4. æ„å»ºæ’ä»¶

```bash
# æ„å»ºæ‰€æœ‰æ’ä»¶
pnpm build
# æˆ–
zhin build

# åªæ„å»ºç‰¹å®šæ’ä»¶
zhin build my-awesome-plugin

# æ¸…ç†åæ„å»º
zhin build --clean
```

### 5. ç”Ÿäº§éƒ¨ç½²

```bash
# ç¡®ä¿æ’ä»¶å·²æ„å»º
pnpm build

# å‰å°æµ‹è¯•
pnpm start
# æˆ–
zhin start

# åå°éƒ¨ç½²
pnpm daemon
# æˆ–
zhin start --daemon --log-file ./logs/production.log
```

### 6. è¿ç»´ç®¡ç†

```bash
# é‡å¯æœåŠ¡
zhin restart

# åœæ­¢æœåŠ¡  
pnpm stop
# æˆ–
zhin stop

# é‡æ–°æ„å»ºæ’ä»¶å¹¶é‡å¯
pnpm build && zhin restart
```

## é«˜çº§é…ç½®

### å¤šç¯å¢ƒé…ç½®

```javascript
// zhin.config.ts
import { defineConfig } from 'zhin.js';

export default defineConfig(async (env) => {
  const isProduction = env.NODE_ENV === 'production';
  
  return {
    bots: [
      {
        context: 'process',
        name: `${process.pid}`,
      }
    ],
    plugin_dirs: [
      './src/plugins',
      ...(isProduction ? [] : ['./dev-plugins'])
    ],
    plugins: [
      'adapter-process',
      'http',
      'console',
      'test-plugin'
    ],
    debug: !isProduction
  };
});
```

### ç¯å¢ƒå˜é‡æ–‡ä»¶

æ”¯æŒè‡ªåŠ¨åŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š
- `.env` - é€šç”¨ç¯å¢ƒå˜é‡
- `.env.development` - å¼€å‘ç¯å¢ƒä¸“ç”¨
- `.env.production` - ç”Ÿäº§ç¯å¢ƒä¸“ç”¨

### è¿›ç¨‹ç®¡ç†

**è‡ªåŠ¨é‡å¯æœºåˆ¶ï¼š**
```typescript
// åœ¨æ’ä»¶ä¸­è§¦å‘é‡å¯
process.exit(51); // ç‰¹æ®Šé€€å‡ºç ï¼Œä¼šè§¦å‘è‡ªåŠ¨é‡å¯
```

**PID æ–‡ä»¶ç®¡ç†ï¼š**
- å¼€å‘æ¨¡å¼ï¼š`.zhin-dev.pid`
- ç”Ÿäº§æ¨¡å¼ï¼š`.zhin.pid`

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **tsx/bun æœªå®‰è£…**
   ```bash
   # å®‰è£… tsx (Node.js è¿è¡Œæ—¶)
   npm install -D tsx
   
   # å®‰è£… bun
   curl -fsSL https://bun.sh/install | bash
   ```

2. **ç«¯å£å ç”¨**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :8086
   
   # ä½¿ç”¨ä¸åŒç«¯å£
   zhin dev --port 8087
   ```

3. **æƒé™é—®é¢˜**
   ```bash
   # ç¡®ä¿é¡¹ç›®ç›®å½•æƒé™
   chmod -R 755 ./my-bot
   ```

## ä¾èµ–é¡¹

### æ ¸å¿ƒä¾èµ–
- `commander` - å‘½ä»¤è¡Œå‚æ•°è§£æ
- `inquirer` - äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢  
- `fs-extra` - å¢å¼ºæ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- `chalk` - å½©è‰²ç»ˆç«¯è¾“å‡º
- `ora` - ä¼˜é›…çš„åŠ è½½æŒ‡ç¤ºå™¨
- `cross-spawn` - è·¨å¹³å°è¿›ç¨‹ç®¡ç†
- `dotenv` - ç¯å¢ƒå˜é‡ç®¡ç†

### å¼€å‘ä¾èµ–  
- `typescript` - TypeScript ç¼–è¯‘å™¨
- `@types/*` - TypeScript ç±»å‹å®šä¹‰

## è®¸å¯è¯

MIT License