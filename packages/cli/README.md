# @zhin.js/cli

Zhin æœºå™¨äººæ¡†æ¶çš„å…¨åŠŸèƒ½å‘½ä»¤è¡Œå·¥å…·ï¼Œæä¾›é¡¹ç›®åˆ›å»ºã€å¼€å‘è°ƒè¯•ã€æ„å»ºéƒ¨ç½²ç­‰å®Œæ•´å¼€å‘æµç¨‹æ”¯æŒã€‚

## æ ¸å¿ƒåŠŸèƒ½

- ğŸš€ **é¡¹ç›®åˆå§‹åŒ–**: äº¤äº’å¼åˆ›å»ºæ–°é¡¹ç›®ï¼Œæ”¯æŒå¤šç§é…ç½®æ ¼å¼
- ğŸ”¥ **å¼€å‘æ¨¡å¼**: çƒ­é‡è½½å¼€å‘æœåŠ¡å™¨ï¼Œå®æ—¶ä»£ç æ›´æ–°
- ğŸ“¦ **é¡¹ç›®æ„å»º**: TypeScriptç¼–è¯‘å’Œä¼˜åŒ–
- ğŸ› ï¸ **è¿›ç¨‹ç®¡ç†**: ç”Ÿäº§ç¯å¢ƒå¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€åå°è¿è¡Œ
- âš™ï¸ **å¤šè¿è¡Œæ—¶**: æ”¯æŒ Node.js å’Œ Bun è¿è¡Œæ—¶
- ğŸ“„ **å¤šé…ç½®æ ¼å¼**: æ”¯æŒ JS/TS/JSON/YAML/TOML é…ç½®æ–‡ä»¶

## å‘½ä»¤è¯¦è§£

### init - é¡¹ç›®åˆå§‹åŒ–

åˆ›å»ºæ–°çš„ Zhin æœºå™¨äººé¡¹ç›®ï¼Œæ”¯æŒäº¤äº’å¼é…ç½®ï¼š

```bash
zhin init [project-name] [options]
```

**é€‰é¡¹ï¼š**
- `-c, --config <format>`: é…ç½®æ–‡ä»¶æ ¼å¼ (json|yaml|toml|ts|js)ï¼Œé»˜è®¤ js
- `-p, --package-manager <manager>`: åŒ…ç®¡ç†å™¨ (npm|yarn|pnpm)ï¼Œé»˜è®¤ pnpm  
- `-r, --runtime <runtime>`: è¿è¡Œæ—¶ (node|bun)ï¼Œé»˜è®¤ node
- `-y, --yes`: ä½¿ç”¨é»˜è®¤é€‰é¡¹ï¼Œè·³è¿‡æ‰€æœ‰äº¤äº’

**ç”Ÿæˆçš„é¡¹ç›®ç»“æ„ï¼š**
```
my-bot/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts          # ä¸»å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ plugins/          # æ’ä»¶ç›®å½•
â”‚       â””â”€â”€ test-plugin.ts # ç¤ºä¾‹æ’ä»¶
â”œâ”€â”€ dist/                # æ„å»ºè¾“å‡ºç›®å½•
â”œâ”€â”€ data/                 # æ•°æ®å­˜å‚¨ç›®å½•
â”œâ”€â”€ zhin.config.[ext]     # é…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json         # é¡¹ç›®é…ç½®
â”œâ”€â”€ tsconfig.json        # TypeScripté…ç½®
â”œâ”€â”€ .gitignore           # Gitå¿½ç•¥è§„åˆ™
â””â”€â”€ README.md            # é¡¹ç›®æ–‡æ¡£
```

**é…ç½®æ–‡ä»¶æ”¯æŒï¼š**
- JavaScript (`zhin.config.ts`) - æ”¯æŒç¯å¢ƒå˜é‡å’ŒåŠ¨æ€é…ç½®
- TypeScript (`zhin.config.ts`) - å®Œæ•´ç±»å‹æ”¯æŒ
- JSON (`zhin.config.json`) - ç®€å•é™æ€é…ç½®
- YAML (`zhin.config.yaml`) - äººæ€§åŒ–æ ¼å¼
- TOML (`zhin.config.toml`) - ç»“æ„åŒ–é…ç½®

### dev - å¼€å‘æ¨¡å¼

å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒçƒ­é‡è½½å’Œå®æ—¶è°ƒè¯•ï¼š

```bash
zhin dev [options]
```

**ç‰¹æ€§ï¼š**
- ğŸ”¥ **çƒ­æ¨¡å—æ›¿æ¢ (HMR)**: ä»£ç ä¿®æ”¹å³æ—¶ç”Ÿæ•ˆ
- ğŸ” **å®æ—¶ç›‘æ§**: è‡ªåŠ¨æ£€æµ‹æ–‡ä»¶å˜åŒ–
- ğŸ› ï¸ **è°ƒè¯•å‹å¥½**: è¯¦ç»†é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
- ğŸ“Š **æ€§èƒ½ç›‘æ§**: å®æ—¶æ€§èƒ½ç»Ÿè®¡

**é€‰é¡¹ï¼š**
- `-p, --port [port]`: HMRæœåŠ¡ç«¯å£ï¼Œé»˜è®¤ 3000
- `--verbose`: æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—è¾“å‡º
- `--bun`: ä½¿ç”¨ bun è¿è¡Œæ—¶ï¼ˆé»˜è®¤ä½¿ç”¨ tsxï¼‰

**ç¯å¢ƒå˜é‡ï¼š**
```bash
NODE_ENV=development
ZHIN_DEV_MODE=true
ZHIN_HMR_PORT=3000
ZHIN_VERBOSE=false
```

### start - ç”Ÿäº§å¯åŠ¨

ç”Ÿäº§ç¯å¢ƒå¯åŠ¨æœºå™¨äººï¼Œæ”¯æŒå‰å°å’Œåå°è¿è¡Œï¼š

```bash
zhin start [options]
```

**ç‰¹æ€§ï¼š**
- ğŸš€ **é«˜æ€§èƒ½**: åŸºäºç¼–è¯‘åçš„ JavaScript è¿è¡Œ
- ğŸ”„ **è‡ªåŠ¨é‡å¯**: æ”¯æŒé…ç½®çƒ­æ›´æ–°é‡å¯ (exit code 51)
- ğŸ“ **æ—¥å¿—ç®¡ç†**: æ”¯æŒæ—¥å¿—æ–‡ä»¶è¾“å‡º
- ğŸ›¡ï¸ **è¿›ç¨‹ç®¡ç†**: å®Œå–„çš„è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†

**é€‰é¡¹ï¼š**
- `-d, --daemon`: åå°è¿è¡Œæ¨¡å¼
- `--log-file [file]`: æŒ‡å®šæ—¥å¿—æ–‡ä»¶è·¯å¾„
- `--bun`: ä½¿ç”¨ bun è¿è¡Œæ—¶ï¼ˆé»˜è®¤ä½¿ç”¨ nodeï¼‰

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# å‰å°è¿è¡Œ
zhin start

# åå°è¿è¡Œ
zhin start --daemon

# åå°è¿è¡Œå¹¶è®°å½•æ—¥å¿—
zhin start --daemon --log-file ./logs/bot.log

# ä½¿ç”¨ bun è¿è¡Œæ—¶
zhin start --bun
```

### restart - é‡å¯æœåŠ¡

é‡å¯ç”Ÿäº§æ¨¡å¼ä¸‹è¿è¡Œçš„æœºå™¨äººï¼š

```bash
zhin restart
```

**åŠŸèƒ½ï¼š**
- ğŸ”„ æ£€æµ‹è¿è¡Œä¸­çš„è¿›ç¨‹
- ğŸ“‹ è¯»å– PID æ–‡ä»¶
- âš¡ å‘é€é‡å¯ä¿¡å·
- ğŸ› ï¸ è‡ªåŠ¨æ•…éšœå¤„ç†

### stop - åœæ­¢æœåŠ¡

åœæ­¢è¿è¡Œä¸­çš„æœºå™¨äººè¿›ç¨‹ï¼š

```bash  
zhin stop
```

**åŠŸèƒ½ï¼š**
- ğŸ›‘ ä¼˜é›…åœæ­¢è¿›ç¨‹
- ğŸ” è‡ªåŠ¨æ£€æµ‹è¿è¡ŒçŠ¶æ€
- ğŸ§¹ æ¸…ç† PID æ–‡ä»¶
- ğŸ“ è¯¦ç»†åœæ­¢æ—¥å¿—

### build - é¡¹ç›®æ„å»º

ç¼–è¯‘ TypeScript ä»£ç ä¸ºç”Ÿäº§ç¯å¢ƒ JavaScriptï¼š

```bash
zhin build [options]
```

**é€‰é¡¹ï¼š**
- `--clean`: æ„å»ºå‰æ¸…ç†è¾“å‡ºç›®å½•

**åŠŸèƒ½ï¼š**
- ğŸ“¦ TypeScript ç¼–è¯‘
- ğŸ¯ ç±»å‹æ£€æŸ¥
- ğŸ—‚ï¸ æ–‡ä»¶ç»„ç»‡
- âš¡ æ„å»ºä¼˜åŒ–

## å®Œæ•´å·¥ä½œæµç¨‹

### 1. åˆ›å»ºæ–°é¡¹ç›®

```bash
# äº¤äº’å¼åˆ›å»º
zhin init my-awesome-bot

# å¿«é€Ÿåˆ›å»ºï¼ˆä½¿ç”¨é»˜è®¤é…ç½®ï¼‰
zhin init my-bot -y

# è‡ªå®šä¹‰é…ç½®
zhin init my-bot -c ts -p pnpm -r bun
```

### 2. å¼€å‘é˜¶æ®µ

```bash
cd my-awesome-bot

# å¼€å‘æ¨¡å¼å¯åŠ¨
zhin dev

# è¯¦ç»†æ—¥å¿—æ¨¡å¼
zhin dev --verbose

# è‡ªå®šä¹‰ç«¯å£
zhin dev --port 8080
```

### 3. ç”Ÿäº§éƒ¨ç½²

```bash
# æ„å»ºé¡¹ç›®
zhin build

# å‰å°æµ‹è¯•
zhin start

# åå°éƒ¨ç½²
zhin start --daemon --log-file ./logs/production.log
```

### 4. è¿ç»´ç®¡ç†

```bash
# é‡å¯æœåŠ¡
zhin restart

# åœæ­¢æœåŠ¡  
zhin stop

# é‡æ–°æ„å»ºå¹¶é‡å¯
zhin build && zhin restart
```

## é«˜çº§é…ç½®

### å¤šç¯å¢ƒé…ç½®

```javascript
// zhin.config.ts
import { defineConfig } from 'zhin.js';

export default defineConfig(async (env) => {
  const isProduction = env.NODE_ENV === 'production';
  
  return {
    bots: [
      {
        context: 'process',
        name: `${process.pid}`,
      }
    ],
    plugin_dirs: [
      './src/plugins',
      ...(isProduction ? [] : ['./dev-plugins'])
    ],
    plugins: [
      'adapter-process',
      'http',
      'console',
      'test-plugin'
    ],
    debug: !isProduction
  };
});
```

### ç¯å¢ƒå˜é‡æ–‡ä»¶

æ”¯æŒè‡ªåŠ¨åŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š
- `.env` - é€šç”¨ç¯å¢ƒå˜é‡
- `.env.development` - å¼€å‘ç¯å¢ƒä¸“ç”¨
- `.env.production` - ç”Ÿäº§ç¯å¢ƒä¸“ç”¨

### è¿›ç¨‹ç®¡ç†

**è‡ªåŠ¨é‡å¯æœºåˆ¶ï¼š**
```typescript
// åœ¨æ’ä»¶ä¸­è§¦å‘é‡å¯
process.exit(51); // ç‰¹æ®Šé€€å‡ºç ï¼Œä¼šè§¦å‘è‡ªåŠ¨é‡å¯
```

**PID æ–‡ä»¶ç®¡ç†ï¼š**
- å¼€å‘æ¨¡å¼ï¼š`.zhin-dev.pid`
- ç”Ÿäº§æ¨¡å¼ï¼š`.zhin.pid`

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **tsx/bun æœªå®‰è£…**
   ```bash
   # å®‰è£… tsx (Node.js è¿è¡Œæ—¶)
   npm install -D tsx
   
   # å®‰è£… bun
   curl -fsSL https://bun.sh/install | bash
   ```

2. **ç«¯å£å ç”¨**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :3000
   
   # ä½¿ç”¨ä¸åŒç«¯å£
   zhin dev --port 8080
   ```

3. **æƒé™é—®é¢˜**
   ```bash
   # ç¡®ä¿é¡¹ç›®ç›®å½•æƒé™
   chmod -R 755 ./my-bot
   ```

## ä¾èµ–é¡¹

### æ ¸å¿ƒä¾èµ–
- `commander` - å‘½ä»¤è¡Œå‚æ•°è§£æ
- `inquirer` - äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢  
- `fs-extra` - å¢å¼ºæ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- `chalk` - å½©è‰²ç»ˆç«¯è¾“å‡º
- `ora` - ä¼˜é›…çš„åŠ è½½æŒ‡ç¤ºå™¨
- `cross-spawn` - è·¨å¹³å°è¿›ç¨‹ç®¡ç†
- `dotenv` - ç¯å¢ƒå˜é‡ç®¡ç†

### å¼€å‘ä¾èµ–  
- `typescript` - TypeScript ç¼–è¯‘å™¨
- `@types/*` - TypeScript ç±»å‹å®šä¹‰

## è®¸å¯è¯

MIT License