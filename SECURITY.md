# å®‰å…¨æ”¿ç­– | Security Policy

[English](#english) | [ä¸­æ–‡](#ä¸­æ–‡)

---

## ä¸­æ–‡

### ğŸ”’ æ”¯æŒçš„ç‰ˆæœ¬

æˆ‘ä»¬ä¸ºä»¥ä¸‹ç‰ˆæœ¬æä¾›å®‰å…¨æ›´æ–°ï¼š

| ç‰ˆæœ¬ | æ”¯æŒçŠ¶æ€ |
| ------- | ------------------ |
| 1.x     | :white_check_mark: |
| < 1.0   | :x:                |

### ğŸ“¢ æŠ¥å‘Šæ¼æ´

Zhin.js å›¢é˜Ÿå’Œç¤¾åŒºéå¸¸é‡è§†å®‰å…¨é—®é¢˜ã€‚æˆ‘ä»¬æ„Ÿè°¢æ‚¨å¸®åŠ©æˆ‘ä»¬ä¿æŠ¤é¡¹ç›®çš„å®‰å…¨ã€‚

#### å¦‚ä½•æŠ¥å‘Š

å¦‚æœæ‚¨å‘ç°äº†å®‰å…¨æ¼æ´ï¼Œè¯·**ä¸è¦**é€šè¿‡ GitHub Issues å…¬å¼€æŠ¥å‘Šã€‚è¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼ç§ä¸‹å‘æˆ‘ä»¬æŠ«éœ²ï¼š

1. **ä¸»è¦æ–¹å¼**ï¼šé€šè¿‡ GitHub Security Advisory ç§ä¸‹æŠ¥å‘Š
   - è®¿é—®é¡¹ç›®çš„ [Security Advisories](https://github.com/zhinjs/zhin/security/advisories) é¡µé¢
   - ç‚¹å‡» "Report a vulnerability"

#### æŠ¥å‘Šå†…å®¹åº”åŒ…æ‹¬

ä¸ºäº†å¸®åŠ©æˆ‘ä»¬æ›´å¿«åœ°ç†è§£å’Œä¿®å¤é—®é¢˜ï¼Œè¯·åœ¨æŠ¥å‘Šä¸­åŒ…å«ï¼š

- æ¼æ´çš„è¯¦ç»†æè¿°
- é‡ç°æ­¥éª¤ï¼ˆå¦‚æœå¯èƒ½ï¼Œæä¾› PoCï¼‰
- å—å½±å“çš„ç‰ˆæœ¬
- æ½œåœ¨å½±å“å’Œä¸¥é‡ç¨‹åº¦
- æ‚¨è®¤ä¸ºå¯èƒ½çš„ä¿®å¤æ–¹æ¡ˆï¼ˆå¯é€‰ï¼‰
- æ‚¨çš„è”ç³»æ–¹å¼

#### å“åº”æ—¶é—´è¡¨

- **ç¡®è®¤æ¥æ”¶**ï¼šæˆ‘ä»¬ä¼šåœ¨ 48 å°æ—¶å†…ç¡®è®¤æ”¶åˆ°æ‚¨çš„æŠ¥å‘Š
- **åˆæ­¥è¯„ä¼°**ï¼š5 ä¸ªå·¥ä½œæ—¥å†…æä¾›åˆæ­¥è¯„ä¼°å’Œé¢„è®¡ä¿®å¤æ—¶é—´
- **ä¿®å¤å‘å¸ƒ**ï¼šæ ¹æ®ä¸¥é‡ç¨‹åº¦ï¼Œæˆ‘ä»¬å°†å°½å¿«å‘å¸ƒä¿®å¤ç‰ˆæœ¬
  - ä¸¥é‡æ¼æ´ï¼š7-14 å¤©
  - ä¸­ç­‰æ¼æ´ï¼š14-30 å¤©
  - ä½å±æ¼æ´ï¼š30-60 å¤©

#### æ¼æ´å¥–åŠ±è®¡åˆ’

ç›®å‰æˆ‘ä»¬æ²¡æœ‰æ­£å¼çš„æ¼æ´å¥–åŠ±è®¡åˆ’ï¼Œä½†æˆ‘ä»¬ä¼šï¼š

- åœ¨ä¿®å¤å…¬å‘Šä¸­æ„Ÿè°¢æŠ¥å‘Šè€…ï¼ˆå¦‚æœæ‚¨å¸Œæœ›ï¼‰
- å°†æ‚¨çš„è´¡çŒ®è®°å½•åœ¨é¡¹ç›®çš„å®‰å…¨è‡´è°¢åˆ—è¡¨ä¸­

### ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å®è·µ

#### å¯¹äºç”¨æˆ·

1. **ä¿æŒæ›´æ–°**
   - å§‹ç»ˆä½¿ç”¨æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬
   - å®šæœŸæ£€æŸ¥å¹¶åº”ç”¨å®‰å…¨æ›´æ–°
   ```bash
   pnpm update @zhin.js/* --latest
   ```

2. **ä¿æŠ¤å‡­è¯**
   - æ°¸è¿œä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
   - ä½¿ç”¨å¼ºå¯†ç ä¿æŠ¤ Web æ§åˆ¶å°
   - å®šæœŸè½®æ¢ API å¯†é’¥å’Œä»¤ç‰Œ

3. **è®¿é—®æ§åˆ¶**
   - é™åˆ¶ Web æ§åˆ¶å°çš„è®¿é—®ï¼ˆä½¿ç”¨é˜²ç«å¢™è§„åˆ™ï¼‰
   - åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ HTTPS
   - è€ƒè™‘ä½¿ç”¨åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰å¢åŠ å®‰å…¨å±‚

4. **ä¾èµ–å®‰å…¨**
   - å®šæœŸè¿è¡Œå®‰å…¨å®¡è®¡
   ```bash
   pnpm audit
   pnpm audit --fix  # è‡ªåŠ¨ä¿®å¤ä½é£é™©æ¼æ´
   ```

5. **é…ç½®å®‰å…¨**
   - å®¡æŸ¥æ’ä»¶æƒé™
   - ç¦ç”¨ä¸éœ€è¦çš„åŠŸèƒ½
   - ä½¿ç”¨æœ€å°æƒé™åŸåˆ™é…ç½®æœºå™¨äººè´¦å·

6. **ç”Ÿäº§ç¯å¢ƒé…ç½®**
   - é¿å…åœ¨ `plugin_dirs` ä¸­é…ç½® `node_modules`ï¼ˆä¼šç›‘å¬å¤§é‡æ–‡ä»¶ï¼‰
   - ä½¿ç”¨ç¯å¢ƒå˜é‡åŒºåˆ†å¼€å‘å’Œç”Ÿäº§é…ç½®
   ```bash
   # ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
   NODE_ENV=production pnpm start
   ```
   - åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä»…åŠ è½½å¿…è¦çš„æ’ä»¶ç›®å½•
   ```typescript
   plugin_dirs: [
     './plugins',  // âœ… ä»…ç›‘å¬é¡¹ç›®æ’ä»¶ç›®å½•
     // 'node_modules',  // âŒ é¿å…ç›‘å¬æ•´ä¸ª node_modules
   ]
   ```

#### å¯¹äºæ’ä»¶å¼€å‘è€…

1. **è¾“å…¥éªŒè¯**
   - å§‹ç»ˆéªŒè¯å’Œæ¸…ç†ç”¨æˆ·è¾“å…¥
   - ä½¿ç”¨ Schema ç³»ç»Ÿè¿›è¡Œç±»å‹æ£€æŸ¥
   ```typescript
   import { Schema, defineSchema } from 'zhin.js'
   
   defineSchema(Schema.object({
     url: Schema.string().pattern(/^https?:\/\//),  // éªŒè¯ URL æ ¼å¼
     count: Schema.number().min(1).max(100)         // é™åˆ¶æ•°å€¼èŒƒå›´
   }))
   ```

2. **é˜²æ­¢æ³¨å…¥æ”»å‡»**
   - ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼Œé¿å… SQL æ³¨å…¥
   ```typescript
   // âœ… æ­£ç¡®ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
   await db.model('users').findOne({ where: { id: userId } })
   
   // âŒ é”™è¯¯ï¼šæ‹¼æ¥ SQL
   await db.query(`SELECT * FROM users WHERE id = ${userId}`)
   ```

3. **æ•æ„Ÿæ•°æ®å¤„ç†**
   - ä¸è¦åœ¨æ—¥å¿—ä¸­è®°å½•æ•æ„Ÿä¿¡æ¯
   - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥
   - åŠ å¯†å­˜å‚¨æ•æ„Ÿæ•°æ®
   ```typescript
   // âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡
   const apiKey = process.env.API_KEY
   
   // âŒ é”™è¯¯ï¼šç¡¬ç¼–ç å¯†é’¥
   const apiKey = 'sk-1234567890abcdef'
   ```

4. **æƒé™æ§åˆ¶**
   - å®ç°é€‚å½“çš„æƒé™æ£€æŸ¥
   - ä½¿ç”¨ä¸­é—´ä»¶è¿›è¡Œè®¿é—®æ§åˆ¶
   ```typescript
   addCommand(new MessageCommand('admin')
     .use(async (message, next) => {
       if (!message.sender.isAdmin) {
         return 'æƒé™ä¸è¶³'
       }
       return next()
     })
     .action(async () => {
       // ç®¡ç†å‘˜æ“ä½œ
     })
   )
   ```

5. **ä¾èµ–ç®¡ç†**
   - ä»…ä½¿ç”¨å¯ä¿¡èµ–çš„ä¾èµ–åŒ…
   - å®šæœŸæ›´æ–°ä¾èµ–åˆ°å®‰å…¨ç‰ˆæœ¬
   - å®¡æŸ¥ä¾èµ–çš„å®‰å…¨å…¬å‘Š

6. **é”™è¯¯å¤„ç†**
   - ä¸è¦æ³„éœ²æ•æ„Ÿçš„é”™è¯¯ä¿¡æ¯
   - å®ç°é€‚å½“çš„é”™è¯¯è¾¹ç•Œ
   ```typescript
   try {
     // æ“ä½œ
   } catch (error) {
     logger.error('æ“ä½œå¤±è´¥', error)  // ä»…åœ¨æ—¥å¿—ä¸­è®°å½•è¯¦ç»†ä¿¡æ¯
     return 'æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'     // å‘ç”¨æˆ·è¿”å›é€šç”¨ä¿¡æ¯
   }
   ```

### âš ï¸ å·²çŸ¥å®‰å…¨æ³¨æ„äº‹é¡¹

1. **Web æ§åˆ¶å°è®¿é—®**
   - é»˜è®¤é…ç½®ä¸‹ï¼ŒWeb æ§åˆ¶å°ç›‘å¬æ‰€æœ‰æ¥å£ï¼ˆ0.0.0.0ï¼‰
   - å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é™åˆ¶è®¿é—®æ¥æº
   - ä½¿ç”¨å¼ºå¯†ç å¹¶è€ƒè™‘å¯ç”¨åŒå› ç´ è®¤è¯ï¼ˆæœªæ¥ç‰ˆæœ¬ï¼‰

2. **æ’ä»¶ç³»ç»Ÿ**
   - æ’ä»¶åœ¨åŒä¸€è¿›ç¨‹ä¸­è¿è¡Œï¼Œå…·æœ‰å®Œæ•´çš„ç³»ç»Ÿè®¿é—®æƒé™
   - ä»…å®‰è£…æ¥è‡ªå¯ä¿¡æ¥æºçš„æ’ä»¶
   - å®¡æŸ¥æ’ä»¶ä»£ç ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠæ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œè®¿é—®çš„éƒ¨åˆ†

3. **é…ç½®æ–‡ä»¶**
   - TypeScript é…ç½®æ–‡ä»¶ï¼ˆ`zhin.config.ts`ï¼‰åœ¨è¿è¡Œæ—¶æ‰§è¡Œ
   - ä¸è¦ä»ä¸å¯ä¿¡æ¥æºåŠ è½½é…ç½®æ–‡ä»¶

4. **çƒ­é‡è½½åŠŸèƒ½**
   - å¼€å‘ç¯å¢ƒåŠŸèƒ½ï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨
   - å¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ä»£ç æ‰§è¡Œ

5. **æ–‡ä»¶ç›‘å¬æ€§èƒ½**
   - é¿å…ç›‘å¬ `node_modules` ç­‰å¤§å‹ç›®å½•
   - åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç¦ç”¨æ–‡ä»¶ç›‘å¬ï¼ˆè®¾ç½® `NODE_ENV=production`ï¼‰
   - ç›‘å¬å¤§é‡æ–‡ä»¶å¯èƒ½å¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ï¼ˆinotify é™åˆ¶ï¼‰
   - å»ºè®®ä»…åœ¨ `plugin_dirs` ä¸­æŒ‡å®šå®é™…æ’ä»¶ç›®å½•è·¯å¾„

### ğŸ” å®‰å…¨åŠŸèƒ½è·¯çº¿å›¾

æˆ‘ä»¬è®¡åˆ’åœ¨æœªæ¥ç‰ˆæœ¬ä¸­å¼•å…¥ï¼š

- [ ] æ’ä»¶æƒé™ç³»ç»Ÿï¼ˆç»†ç²’åº¦æƒé™æ§åˆ¶ï¼‰
- [ ] ä»£ç ç­¾åéªŒè¯ï¼ˆéªŒè¯æ’ä»¶å®Œæ•´æ€§ï¼‰
- [ ] å®¡è®¡æ—¥å¿—ï¼ˆè®°å½•æ•æ„Ÿæ“ä½œï¼‰
- [ ] åŒå› ç´ è®¤è¯ï¼ˆå¢å¼ºæ§åˆ¶å°å®‰å…¨ï¼‰
- [ ] æ²™ç®±ç¯å¢ƒï¼ˆéš”ç¦»æ’ä»¶æ‰§è¡Œï¼‰
- [x] è‡ªåŠ¨å®‰å…¨æ‰«æï¼ˆCI/CD é›†æˆï¼‰

### ğŸ“ è”ç³»æ–¹å¼

- **å®‰å…¨é—®é¢˜**ï¼š[security@zhin.dev](mailto:security@zhin.dev)
- **ä¸€èˆ¬é—®é¢˜**ï¼š[GitHub Issues](https://github.com/zhinjs/zhin/issues)
- **è®¨è®º**ï¼š[GitHub Discussions](https://github.com/zhinjs/zhin/discussions)

---

## English

### ğŸ”’ Supported Versions

We provide security updates for the following versions:

| Version | Support Status     |
| ------- | ------------------ |
| 1.x     | :white_check_mark: |
| < 1.0   | :x:                |

### ğŸ“¢ Reporting a Vulnerability

The Zhin.js team and community take security issues seriously. We appreciate your efforts to responsibly disclose your findings.

#### How to Report

If you discover a security vulnerability, please **DO NOT** report it publicly via GitHub Issues. Instead, please disclose it privately through one of the following methods:

1. **Preferred Method**: Email us at [security@zhin.dev](mailto:security@zhin.dev)
2. **Alternative**: Report privately via GitHub Security Advisory
   - Visit the project's [Security Advisories](https://github.com/zhinjs/zhin/security/advisories) page
   - Click "Report a vulnerability"

#### What to Include

To help us understand and fix the issue faster, please include:

- Detailed description of the vulnerability
- Steps to reproduce (provide PoC if possible)
- Affected versions
- Potential impact and severity
- Possible fix suggestions (optional)
- Your contact information

#### Response Timeline

- **Acknowledgment**: We will acknowledge receipt within 48 hours
- **Initial Assessment**: Initial assessment and estimated fix timeline within 5 business days
- **Fix Release**: Depending on severity, we will release a fix as soon as possible
  - Critical: 7-14 days
  - Medium: 14-30 days
  - Low: 30-60 days

#### Bug Bounty Program

We currently do not have a formal bug bounty program, but we will:

- Credit you in the security advisory (if you wish)
- List your contribution in the project's security acknowledgments

### ğŸ›¡ï¸ Security Best Practices

#### For Users

1. **Keep Updated**
   - Always use the latest stable version
   - Regularly check and apply security updates
   ```bash
   pnpm update @zhin.js/* --latest
   ```

2. **Protect Credentials**
   - Never commit `.env` files to version control
   - Use strong passwords for Web console
   - Regularly rotate API keys and tokens

3. **Access Control**
   - Restrict Web console access (use firewall rules)
   - Use HTTPS in production
   - Consider using a reverse proxy (e.g., Nginx) for additional security

4. **Dependency Security**
   - Regularly run security audits
   ```bash
   pnpm audit
   pnpm audit --fix  # Auto-fix low-risk vulnerabilities
   ```

5. **Configuration Security**
   - Review plugin permissions
   - Disable unnecessary features
   - Use least privilege principle for bot accounts

6. **Production Environment Configuration**
   - Avoid configuring `node_modules` in `plugin_dirs` (watches too many files)
   - Use environment variables to distinguish dev and production configs
   ```bash
   # Production startup
   NODE_ENV=production pnpm start
   ```
   - Load only necessary plugin directories in production
   ```typescript
   plugin_dirs: [
     './plugins',  // âœ… Only watch project plugin directory
     // 'node_modules',  // âŒ Avoid watching entire node_modules
   ]
   ```

#### For Plugin Developers

1. **Input Validation**
   - Always validate and sanitize user input
   - Use Schema system for type checking
   ```typescript
   import { Schema, defineSchema } from 'zhin.js'
   
   defineSchema(Schema.object({
     url: Schema.string().pattern(/^https?:\/\//),  // Validate URL format
     count: Schema.number().min(1).max(100)         // Limit numeric range
   }))
   ```

2. **Prevent Injection Attacks**
   - Use parameterized queries to prevent SQL injection
   ```typescript
   // âœ… Correct: Use parameterized queries
   await db.model('users').findOne({ where: { id: userId } })
   
   // âŒ Wrong: Concatenate SQL
   await db.query(`SELECT * FROM users WHERE id = ${userId}`)
   ```

3. **Sensitive Data Handling**
   - Don't log sensitive information
   - Store secrets in environment variables
   - Encrypt sensitive data at rest
   ```typescript
   // âœ… Correct: Use environment variables
   const apiKey = process.env.API_KEY
   
   // âŒ Wrong: Hardcode secrets
   const apiKey = 'sk-1234567890abcdef'
   ```

4. **Permission Control**
   - Implement proper permission checks
   - Use middleware for access control
   ```typescript
   addCommand(new MessageCommand('admin')
     .use(async (message, next) => {
       if (!message.sender.isAdmin) {
         return 'Insufficient permissions'
       }
       return next()
     })
     .action(async () => {
       // Admin operations
     })
   )
   ```

5. **Dependency Management**
   - Only use trusted dependency packages
   - Regularly update dependencies to secure versions
   - Review security advisories for dependencies

6. **Error Handling**
   - Don't leak sensitive error information
   - Implement proper error boundaries
   ```typescript
   try {
     // Operations
   } catch (error) {
     logger.error('Operation failed', error)  // Log details only in logs
     return 'Operation failed, please try again later'  // Generic message to users
   }
   ```

### âš ï¸ Known Security Considerations

1. **Web Console Access**
   - By default, Web console listens on all interfaces (0.0.0.0)
   - Recommend restricting access sources in production
   - Use strong passwords and consider enabling 2FA (future version)

2. **Plugin System**
   - Plugins run in the same process with full system access
   - Only install plugins from trusted sources
   - Review plugin code, especially filesystem and network access

3. **Configuration Files**
   - TypeScript config files (`zhin.config.ts`) execute at runtime
   - Don't load config files from untrusted sources

4. **Hot Reload Feature**
   - Development environment feature, not recommended for production
   - May lead to unauthorized code execution

5. **File Watching Performance**
   - Avoid watching large directories like `node_modules`
   - Disable file watching in production (set `NODE_ENV=production`)
   - Watching too many files can exhaust server resources (inotify limits)
   - Recommend specifying only actual plugin directories in `plugin_dirs`

### ğŸ” Security Roadmap

We plan to introduce in future versions:

- [ ] Plugin permission system (fine-grained permission control)
- [ ] Code signing verification (verify plugin integrity)
- [ ] Audit logging (record sensitive operations)
- [ ] Two-factor authentication (enhance console security)
- [ ] Sandbox environment (isolate plugin execution)
- [x] Automated security scanning (CI/CD integration)

### ğŸ“ Contact

- **Security Issues**: [security@zhin.dev](mailto:security@zhin.dev)
- **General Issues**: [GitHub Issues](https://github.com/zhinjs/zhin/issues)
- **Discussions**: [GitHub Discussions](https://github.com/zhinjs/zhin/discussions)

---

**Last Updated**: November 2025

