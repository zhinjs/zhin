# Tools Guide - 工具和技能系统

## 核心原则：工具和技能的协作

### 关键概念
**技能 = 知识领域 + 关联工具**

当一个技能被激活时（通过 `activate_skill` 或系统识别），该技能的 SKILL.md frontmatter 中声明的工具就**已经处于激活状态**。这意味着：

- ✅ 你**必须**调用这些工具来完成任务
- ✅ 用户期望你立即执行，而不是解释
- ✅ 技能内容明确了工具调用的场景和时机
- ❌ 不要只描述工具功能，要执行它们

### 技能识别规则

**什么时候技能被认为是激活的？**

1. **显式激活**：用户说"使用 [技能名]"或"激活 [技能]"
2. **隐式识别**：用户请求与技能描述匹配（通过 keywords、description 自动识别）
3. **自动绑定**：关联的工具声明告诉你应该做什么

**当技能激活时，你的行为准则：**

- 立即执行技能 SKILL.md 中列出的工具
- 不要等待二次确认
- 遵循 SKILL.md 中的工作流程指导
- 基于工具结果生成有价值的回答

## 工具使用的三层级别

### 第一层：直接调用（最常见）
**无需解释的工具调用** - 立即执行

```
用户: "读取 package.json"
AI 行为: 直接调用 file_read("package.json") → 显示结果
```

**适用工具：**
- `file_read` - 读取文件
- `web_search` - 搜索信息
- `file_list` - 列表查询
- `semantic_search` - 代码搜索

### 第二层：有条件调用（需要判断）
**根据用户请求和上下文判断是否调用**

```
用户: "帮我改进这个函数"
AI 行为: 
  1. 如果有上下文 → 直接分析
  2. 如果没有代码 → 先 file_read 获取
  3. 分析后显示改进建议
```

### 第三层：多步骤工作流（需要规划）
**先概述计划，再逐步执行**

```
用户: "重构整个模块并部署"
AI 行为:
  1. 概述步骤: 分析 → 修改 → 测试 → 部署
  2. 逐步执行每个工具调用
  3. 验证每步结果
  4. 显示最终状态
```

## 常用工具场景与执行时机

### 文件操作
| 用户请求 | 工具 | 何时调用 | 示例 |
|--------|------|---------|------|
| 读取/查看文件 | `file_read` | **立即** | "读取 src/main.ts" |
| 创建/修改文件 | `file_write` | **立即**（可选先 read） | "创建 test.ts" |
| 列表文件 | `file_list` | **立即** | "列出 src/ 目录" |
| 搜索代码 | `semantic_search` | **立即** | "搜索错误处理逻辑" |

### 网络操作
| 用户请求 | 工具 | 何时调用 | 示例 |
|--------|------|---------|------|
| 查询信息 | `web_search` | **立即** | "搜索 Node.js 最佳实践" |
| 获取网页 | `web_fetch` | **立即** | "获取 URL 内容" |

### 系统操作
| 用户请求 | 工具 | 何时调用 | 注意 |
|--------|------|---------|------|
| 执行命令 | `shell_exec` | **谨慎**（说明理由） | "运行测试命令" |
| 创建计划 | `plan_create` | **立即** | "规划项目结构" |

### 技能与学习
| 用户请求 | 工具 | 何时调用 | 示例 |
|--------|------|---------|------|
| 保存知识 | `memory_store` | 学到新的用户偏好/重要信息时 | "记住用户偏好" |
| 检索知识 | `memory_search` | 需要历史上下文时 | "查看之前的讨论" |
| 激活技能 | 识别技能关键词 | 用户提到技能名称时 | "使用 test-skill" |

## 工具调用的完整流程

### 流程图
```
用户请求
    ↓
识别技能或工具需求？
    ↓ (是)
读取技能 SKILL.md
    ↓
获取关联工具列表
    ↓
执行工具（按 SKILL.md 指导）
    ↓
基于结果生成答案
```

### 具体例子

**用户请求：** "使用 test-skill 读取 package.json 文件"

**AI 执行流程：**
```
1. 识别："test-skill" 被激活
2. 读取：SKILL.md frontmatter 中 tools: [file_read, file_write, web_search]
3. 匹配：用户要求"读取" → 对应 file_read 工具
4. 调用：file_read(path: "package.json")
5. 处理：解析 JSON，提取关键信息
6. 返回：显示项目名称、版本、依赖等结果
```

## 关键行为准则

### ✅ 应该做的事

- ✅ 技能激活后立即查看 SKILL.md 了解工作流程
- ✅ 按 SKILL.md 指导的顺序调用工具
- ✅ 基于工具结果而不是猜测来回答
- ✅ 工具失败时尝试替代方案
- ✅ 向用户报告执行结果（成功/失败）
- ✅ 在工作流执行中间记录进度

### ❌ 不应该做的事

- ❌ 技能激活后只输出 SKILL.md 内容本身
- ❌ 说"我会用工具X来做..."而不实际执行
- ❌ 等待用户的二次确认再调用工具
- ❌ 忽视 SKILL.md 中的执行指导
- ❌ 调用与请求不相关的工具
- ❌ 工具失败后放弃而不尝试替代方案

## 注意事项
- 工具调用后务必基于结果生成完整回答
- 避免重复调用同一工具获取相同信息
- 遇到权限或依赖问题时，向用户说明并提供替代方案
- **技能激活时，优先执行而非解释 - 这是最重要的原则**
